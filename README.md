# k8s-coredump-detector

----

 K8s-coredump-detector is an open source tool for managing core dump feature in kubernetes.
 It enables stable, controllable core dump feature when jobs inside k8s containers were crashed.
 This feature mainly generate, store, distribute core files which generated by the apps inside pods,
 it could ease investigation of crashed application in multi-tenancy k8s environment. And tenant
 could download this core files like they are using any other original k8s functions.

----

## Design

### Backend storage

The bakcend storage is an dependent filesystem storage to store core files. This storage could be either ceph filesystem storage,
nfs storage or any other filesystem storage.
For test purpose, you can also use local host[https://kubernetes.io/docs/concepts/storage/volumes/#hostpath] storage to store core files.

### Core file generation

<img src="https://github.com/WanLinghao/coredump-detector/blob/master/pictures/design_coredump.jpg" width="500">

The core file generation part generates core files when job inside containers crashed. In each node that supports core dump feature,
 a admin-pod will be deployed by DaemonSet to handle this job. Each admin-pod inject an executable file  called handler into node,
 it also modifies[core-pattern] to let kernel call that handler to store core files into backend storage.

### Downloding core files

<img src="https://github.com/WanLinghao/coredump-detector/blob/master/pictures/design_user.jpg" width="500">

An aggregation api layer will register a self-defined API called `coredump.fujitsu.com`. This api is a bridge between backend storage
 and users. User could download core files by this api. Admin can control users' access to core files by native way like RBAC, ABAC.

## Deployment

See [INSTALL.md](INSTALL.md) for details about how to deploy k8s-audit-collector
